<!DOCTYPE html>
<html>
<head>
    <title>Reader App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-5">
    <h1 class="mb-4">Messages</h1>
    <div id="messagesList" class="list-group mb-4"></div>

    <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmClearModal">Clear All</button>
</div>

<!-- Clear All Confirmation Modal -->
<div class="modal fade" id="confirmClearModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Clear All Messages</h5></div>
      <div class="modal-body">Are you sure you want to delete all messages?</div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button id="confirmClearAllBtn" class="btn btn-danger">Clear All</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>

function deleteMessage(id) {
    fetch(`/delete/${id}`, { method: 'POST' })
        .then(() => loadMessages());
}

// Load messages dynamically
function loadMessages() {
    fetch('/api/messages')
        .then(res => res.json())
        .then(data => {
            const container = document.getElementById('messagesList');
            container.innerHTML = '';

            if (data.length === 0) {
                container.innerHTML = '<div class="alert alert-info">No messages found.</div>';
                return;
            }

            data.forEach(msg => {
                const el = document.createElement('div');
                el.className = 'list-group-item d-flex justify-content-between align-items-center';
                el.innerHTML = `
                    <span>${msg.content}</span>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteMessage(${msg.id})">Delete</button>
                `;
                container.appendChild(el);
            });
        });
}

// Clear all handler
document.getElementById('confirmClearAllBtn').addEventListener('click', () => {
    fetch('/delete_all', { method: 'POST' })
        .then(() => {
            loadMessages();
            bootstrap.Modal.getInstance(document.getElementById('confirmClearModal')).hide();
        });
});

// Initial load
loadMessages();
</script>
</body>
</html>
